---

title: CatBoost

keywords: fastai
sidebar: home_sidebar

summary: "API details."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/03_models.catboost.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://github.com/catboost/tutorials/blob/master/python_tutorial.ipynb">https://github.com/catboost/tutorials/blob/master/python_tutorial.ipynb</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://www.kaggle.com/c/avito-demand-prediction/discussion/59880">https://www.kaggle.com/c/avito-demand-prediction/discussion/59880</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gc</span>


<span class="kn">from</span> <span class="nn">catboost</span> <span class="k">import</span> <span class="n">CatBoostRegressor</span><span class="p">,</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cv</span>

<span class="kn">import</span> <span class="nn">hyperopt</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-loading">Data loading<a class="anchor-link" href="#Data-loading">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/sales_train.csv&quot;</span><span class="p">)</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>date_block_num</th>
      <th>shop_id</th>
      <th>item_id</th>
      <th>item_price</th>
      <th>item_cnt_day</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>02.01.2013</td>
      <td>0</td>
      <td>59</td>
      <td>22154</td>
      <td>999.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>03.01.2013</td>
      <td>0</td>
      <td>25</td>
      <td>2552</td>
      <td>899.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>05.01.2013</td>
      <td>0</td>
      <td>25</td>
      <td>2552</td>
      <td>899.00</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>06.01.2013</td>
      <td>0</td>
      <td>25</td>
      <td>2554</td>
      <td>1709.05</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>15.01.2013</td>
      <td>0</td>
      <td>25</td>
      <td>2555</td>
      <td>1099.00</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="n">data_df</span><span class="o">.</span><span class="n">date_block_num</span> <span class="o">&lt;</span> <span class="mi">33</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;item_cnt_day&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="n">data_df</span><span class="o">.</span><span class="n">date_block_num</span> <span class="o">&lt;</span> <span class="mi">33</span><span class="p">][</span><span class="s1">&#39;item_cnt_day&#39;</span><span class="p">]</span>
<span class="n">X_valid</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="n">data_df</span><span class="o">.</span><span class="n">date_block_num</span> <span class="o">==</span> <span class="mi">33</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;item_cnt_day&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Y_valid</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="n">data_df</span><span class="o">.</span><span class="n">date_block_num</span> <span class="o">==</span> <span class="mi">33</span><span class="p">][</span><span class="s1">&#39;item_cnt_day&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="n">data_df</span><span class="o">.</span><span class="n">date_block_num</span> <span class="o">==</span> <span class="mi">34</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;item_cnt_day&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date_block_num</th>
      <th>shop_id</th>
      <th>item_id</th>
      <th>item_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>59</td>
      <td>22154</td>
      <td>999.00</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0</td>
      <td>25</td>
      <td>2552</td>
      <td>899.00</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>25</td>
      <td>2552</td>
      <td>899.00</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0</td>
      <td>25</td>
      <td>2554</td>
      <td>1709.05</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>25</td>
      <td>2555</td>
      <td>1099.00</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">data_df</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-training">Model training<a class="anchor-link" href="#Model-training">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_use_GPU</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">is_use_GPU</span><span class="p">:</span>
    <span class="n">task_type</span> <span class="o">=</span> <span class="s2">&quot;GPU&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">task_type</span> <span class="o">=</span> <span class="s2">&quot;CPU&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hyperopt">Hyperopt<a class="anchor-link" href="#Hyperopt">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">hyperopt_objective</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span>
        <span class="n">task_type</span> <span class="o">=</span> <span class="n">task_type</span><span class="p">,</span>
        <span class="n">l2_leaf_reg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;l2_leaf_reg&#39;</span><span class="p">]),</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">],</span>
        <span class="n">depth</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]),</span>
        
        <span class="n">iterations</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="c1"># go to 500</span>
        <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span>
        <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;Silent&#39;</span>
    <span class="p">)</span>
    
    <span class="n">cv_data</span> <span class="o">=</span> <span class="n">cv</span><span class="p">(</span>
        <span class="n">Pool</span><span class="p">(</span><span class="n">X_train</span>
                <span class="p">,</span> <span class="n">Y_train</span>
                <span class="p">,</span> <span class="n">cat_features</span> <span class="o">=</span> <span class="n">categorical_features_indices</span>
            <span class="p">)</span>
        <span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cv_data</span><span class="p">[</span><span class="s1">&#39;test-RMSE-mean&#39;</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">best_rmse</span> <span class="c1"># as hyperopt minimises</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">do_tuning</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">if</span> <span class="n">do_tuning</span><span class="p">:</span>
    <span class="n">params_space</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;l2_leaf_reg&#39;</span><span class="p">:</span> <span class="n">hyperopt</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">qloguniform</span><span class="p">(</span><span class="s1">&#39;l2_leaf_reg&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">hyperopt</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">5e-1</span><span class="p">),</span>
        <span class="c1">#&#39;depth&#39; : hyperopt.hp.uniform(&#39;depth&#39;, 5, 15)</span>
        <span class="s1">&#39;depth&#39;</span> <span class="p">:</span> <span class="n">hyperopt</span><span class="o">.</span><span class="n">hp</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="n">trials</span> <span class="o">=</span> <span class="n">hyperopt</span><span class="o">.</span><span class="n">Trials</span><span class="p">()</span>

    <span class="n">best</span> <span class="o">=</span> <span class="n">hyperopt</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span>
        <span class="n">hyperopt_objective</span><span class="p">,</span>
        <span class="n">space</span><span class="o">=</span><span class="n">params_space</span><span class="p">,</span>
        <span class="n">algo</span><span class="o">=</span><span class="n">hyperopt</span><span class="o">.</span><span class="n">tpe</span><span class="o">.</span><span class="n">suggest</span><span class="p">,</span>
        <span class="n">max_evals</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="c1"># go to 50</span>
        <span class="n">trials</span><span class="o">=</span><span class="n">trials</span><span class="p">,</span>
        <span class="n">rstate</span><span class="o">=</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-parametrization">Model parametrization<a class="anchor-link" href="#Model-parametrization">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;task type:&quot;</span><span class="p">,</span><span class="n">task_type</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span>
    <span class="n">task_type</span> <span class="o">=</span> <span class="n">task_type</span>
    <span class="p">,</span><span class="n">loss_function</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span>
    <span class="p">,</span><span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">,</span><span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;Info&#39;</span>
    
    <span class="p">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1000</span> <span class="c1"># go to 500</span>
    <span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="mi">7</span>
    <span class="p">,</span><span class="n">l2_leaf_reg</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.36</span>
    
    <span class="p">,</span><span class="n">thread_count</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">,</span><span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">50</span>
<span class="p">)</span>

<span class="n">train_pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">X_train</span>
                  <span class="p">,</span> <span class="n">Y_train</span>
                  <span class="c1">#, cat_features=categorical_features_indices</span>
                 <span class="p">)</span>

<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_pool</span>
                  <span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span> 
                  <span class="p">,</span> <span class="n">use_best_model</span><span class="o">=</span><span class="kc">True</span>
                  <span class="p">,</span> <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">Y_valid</span><span class="p">)])</span>

<span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>task type: CPU
0:	learn: 2.2294130	test: 9.7623564	best: 9.7623564 (0)	total: 762ms	remaining: 12m 41s
1:	learn: 2.2051488	test: 9.7571760	best: 9.7571760 (1)	total: 1.14s	remaining: 9m 31s
2:	learn: 2.1936169	test: 9.7581899	best: 9.7571760 (1)	total: 1.55s	remaining: 8m 37s
3:	learn: 2.1501633	test: 9.6044575	best: 9.6044575 (3)	total: 1.84s	remaining: 7m 37s
4:	learn: 2.1415261	test: 9.6035323	best: 9.6035323 (4)	total: 2.13s	remaining: 7m 5s
5:	learn: 2.1368785	test: 9.6032698	best: 9.6032698 (5)	total: 2.54s	remaining: 7m
6:	learn: 2.1271711	test: 9.6032873	best: 9.6032698 (5)	total: 2.84s	remaining: 6m 43s
7:	learn: 2.1240736	test: 9.6031107	best: 9.6031107 (7)	total: 3.27s	remaining: 6m 46s
8:	learn: 2.1198226	test: 9.6070751	best: 9.6031107 (7)	total: 3.56s	remaining: 6m 32s
9:	learn: 2.1158140	test: 9.6057547	best: 9.6031107 (7)	total: 3.85s	remaining: 6m 21s
10:	learn: 2.1068363	test: 9.6056186	best: 9.6031107 (7)	total: 4.15s	remaining: 6m 12s
11:	learn: 2.1054902	test: 9.6058995	best: 9.6031107 (7)	total: 4.45s	remaining: 6m 6s
12:	learn: 2.1029512	test: 9.6059401	best: 9.6031107 (7)	total: 4.78s	remaining: 6m 3s
13:	learn: 2.0810105	test: 9.6061047	best: 9.6031107 (7)	total: 5.09s	remaining: 5m 58s
14:	learn: 2.0782914	test: 9.6060214	best: 9.6031107 (7)	total: 5.38s	remaining: 5m 53s
15:	learn: 2.0768353	test: 9.6059496	best: 9.6031107 (7)	total: 5.73s	remaining: 5m 52s
16:	learn: 2.0592506	test: 9.5452229	best: 9.5452229 (16)	total: 6.03s	remaining: 5m 48s
17:	learn: 2.0578205	test: 9.5449473	best: 9.5449473 (17)	total: 6.32s	remaining: 5m 44s
18:	learn: 2.0554762	test: 9.5449793	best: 9.5449473 (17)	total: 6.69s	remaining: 5m 45s
19:	learn: 2.0538966	test: 9.5449150	best: 9.5449150 (19)	total: 6.98s	remaining: 5m 41s
20:	learn: 2.0201790	test: 9.5452356	best: 9.5449150 (19)	total: 7.41s	remaining: 5m 45s
21:	learn: 2.0159917	test: 9.5444882	best: 9.5444882 (21)	total: 8.11s	remaining: 6m
22:	learn: 2.0144246	test: 9.5430907	best: 9.5430907 (22)	total: 8.46s	remaining: 5m 59s
23:	learn: 2.0137116	test: 9.5430047	best: 9.5430047 (23)	total: 8.93s	remaining: 6m 3s
24:	learn: 2.0083557	test: 9.5436835	best: 9.5430047 (23)	total: 9.32s	remaining: 6m 3s
25:	learn: 2.0014393	test: 9.5490417	best: 9.5430047 (23)	total: 9.63s	remaining: 6m
26:	learn: 1.9996181	test: 9.5490454	best: 9.5430047 (23)	total: 9.94s	remaining: 5m 58s
27:	learn: 1.9960842	test: 9.5384069	best: 9.5384069 (27)	total: 10.2s	remaining: 5m 55s
28:	learn: 1.9933633	test: 9.5379635	best: 9.5379635 (28)	total: 10.5s	remaining: 5m 52s
29:	learn: 1.9920022	test: 9.5380063	best: 9.5379635 (28)	total: 10.9s	remaining: 5m 51s
30:	learn: 1.9905059	test: 9.5379752	best: 9.5379635 (28)	total: 11.2s	remaining: 5m 48s
31:	learn: 1.9898216	test: 9.5380038	best: 9.5379635 (28)	total: 11.5s	remaining: 5m 46s
32:	learn: 1.9885853	test: 9.5380456	best: 9.5379635 (28)	total: 11.8s	remaining: 5m 45s
33:	learn: 1.9840746	test: 9.5384603	best: 9.5379635 (28)	total: 12.1s	remaining: 5m 42s
34:	learn: 1.9825693	test: 9.5384415	best: 9.5379635 (28)	total: 12.4s	remaining: 5m 42s
35:	learn: 1.9819100	test: 9.5384631	best: 9.5379635 (28)	total: 12.7s	remaining: 5m 40s
36:	learn: 1.9783488	test: 9.5194970	best: 9.5194970 (36)	total: 13s	remaining: 5m 38s
37:	learn: 1.9759464	test: 9.5196083	best: 9.5194970 (36)	total: 13.3s	remaining: 5m 36s
38:	learn: 1.9745541	test: 9.5195385	best: 9.5194970 (36)	total: 13.6s	remaining: 5m 34s
39:	learn: 1.9741921	test: 9.5189835	best: 9.5189835 (39)	total: 13.9s	remaining: 5m 32s
40:	learn: 1.9719567	test: 9.5192959	best: 9.5189835 (39)	total: 14.2s	remaining: 5m 31s
41:	learn: 1.9699940	test: 9.5226360	best: 9.5189835 (39)	total: 14.5s	remaining: 5m 30s
42:	learn: 1.9690314	test: 9.5226526	best: 9.5189835 (39)	total: 14.8s	remaining: 5m 28s
43:	learn: 1.9681814	test: 9.5223103	best: 9.5189835 (39)	total: 15.1s	remaining: 5m 27s
44:	learn: 1.9669671	test: 9.5223395	best: 9.5189835 (39)	total: 15.4s	remaining: 5m 27s
45:	learn: 1.9663137	test: 9.5223377	best: 9.5189835 (39)	total: 15.8s	remaining: 5m 26s
46:	learn: 1.9585372	test: 9.5224917	best: 9.5189835 (39)	total: 16.1s	remaining: 5m 25s
47:	learn: 1.9555785	test: 9.5224015	best: 9.5189835 (39)	total: 16.4s	remaining: 5m 24s
48:	learn: 1.9532166	test: 9.5223861	best: 9.5189835 (39)	total: 16.7s	remaining: 5m 24s
49:	learn: 1.9423671	test: 9.4957291	best: 9.4957291 (49)	total: 17s	remaining: 5m 22s
50:	learn: 1.9417486	test: 9.4957165	best: 9.4957165 (50)	total: 17.3s	remaining: 5m 22s
51:	learn: 1.9404602	test: 9.4958250	best: 9.4957165 (50)	total: 17.7s	remaining: 5m 22s
52:	learn: 1.9397528	test: 9.4957455	best: 9.4957165 (50)	total: 18s	remaining: 5m 21s
53:	learn: 1.9395772	test: 9.4956705	best: 9.4956705 (53)	total: 18.3s	remaining: 5m 20s
54:	learn: 1.9384863	test: 9.4958275	best: 9.4956705 (53)	total: 18.6s	remaining: 5m 19s
55:	learn: 1.9374777	test: 9.4958213	best: 9.4956705 (53)	total: 18.9s	remaining: 5m 18s
56:	learn: 1.9358561	test: 9.4958816	best: 9.4956705 (53)	total: 19.2s	remaining: 5m 18s
57:	learn: 1.9355292	test: 9.4954360	best: 9.4954360 (57)	total: 19.5s	remaining: 5m 17s
58:	learn: 1.9350090	test: 9.4954379	best: 9.4954360 (57)	total: 19.8s	remaining: 5m 16s
59:	learn: 1.9345830	test: 9.4953724	best: 9.4953724 (59)	total: 20.1s	remaining: 5m 15s
60:	learn: 1.9339920	test: 9.4940154	best: 9.4940154 (60)	total: 20.4s	remaining: 5m 14s
61:	learn: 1.9333693	test: 9.4938951	best: 9.4938951 (61)	total: 20.7s	remaining: 5m 13s
62:	learn: 1.9328305	test: 9.4938748	best: 9.4938748 (62)	total: 21s	remaining: 5m 12s
63:	learn: 1.9321213	test: 9.4938460	best: 9.4938460 (63)	total: 21.3s	remaining: 5m 11s
64:	learn: 1.9311226	test: 9.4937678	best: 9.4937678 (64)	total: 21.6s	remaining: 5m 11s
65:	learn: 1.9305096	test: 9.4937432	best: 9.4937432 (65)	total: 21.9s	remaining: 5m 10s
66:	learn: 1.9292910	test: 9.4936138	best: 9.4936138 (66)	total: 22.2s	remaining: 5m 9s
67:	learn: 1.9287599	test: 9.4931998	best: 9.4931998 (67)	total: 22.6s	remaining: 5m 9s
68:	learn: 1.9221245	test: 9.4932393	best: 9.4931998 (67)	total: 22.8s	remaining: 5m 8s
69:	learn: 1.9206909	test: 9.4932762	best: 9.4931998 (67)	total: 23.1s	remaining: 5m 7s
70:	learn: 1.9198678	test: 9.4933398	best: 9.4931998 (67)	total: 23.5s	remaining: 5m 6s
71:	learn: 1.9154574	test: 9.2012161	best: 9.2012161 (71)	total: 23.7s	remaining: 5m 6s
72:	learn: 1.9149297	test: 9.2021055	best: 9.2012161 (71)	total: 24s	remaining: 5m 5s
73:	learn: 1.9129130	test: 9.2020137	best: 9.2012161 (71)	total: 24.3s	remaining: 5m 4s
74:	learn: 1.9126102	test: 9.2019478	best: 9.2012161 (71)	total: 24.6s	remaining: 5m 3s
75:	learn: 1.9123056	test: 9.2019374	best: 9.2012161 (71)	total: 25s	remaining: 5m 3s
76:	learn: 1.9119048	test: 9.2019487	best: 9.2012161 (71)	total: 25.4s	remaining: 5m 3s
77:	learn: 1.9115290	test: 9.2019058	best: 9.2012161 (71)	total: 25.7s	remaining: 5m 3s
78:	learn: 1.9113093	test: 9.2019455	best: 9.2012161 (71)	total: 26s	remaining: 5m 3s
79:	learn: 1.9100641	test: 9.2019401	best: 9.2012161 (71)	total: 26.6s	remaining: 5m 6s
80:	learn: 1.9092528	test: 9.2018577	best: 9.2012161 (71)	total: 26.9s	remaining: 5m 5s
81:	learn: 1.9086414	test: 9.2009977	best: 9.2009977 (81)	total: 27.4s	remaining: 5m 6s
82:	learn: 1.9080905	test: 9.2010584	best: 9.2009977 (81)	total: 27.7s	remaining: 5m 6s
83:	learn: 1.9078817	test: 9.2009837	best: 9.2009837 (83)	total: 28s	remaining: 5m 5s
84:	learn: 1.9076017	test: 9.2009681	best: 9.2009681 (84)	total: 28.3s	remaining: 5m 5s
85:	learn: 1.9072400	test: 9.2009794	best: 9.2009681 (84)	total: 28.7s	remaining: 5m 4s
86:	learn: 1.9042095	test: 8.9681315	best: 8.9681315 (86)	total: 29s	remaining: 5m 3s
87:	learn: 1.9040063	test: 8.9679599	best: 8.9679599 (87)	total: 29.3s	remaining: 5m 3s
88:	learn: 1.9033946	test: 8.9677645	best: 8.9677645 (88)	total: 29.6s	remaining: 5m 2s
89:	learn: 1.9023357	test: 8.9677520	best: 8.9677520 (89)	total: 29.9s	remaining: 5m 1s
90:	learn: 1.9018698	test: 8.9676577	best: 8.9676577 (90)	total: 30.2s	remaining: 5m 1s
91:	learn: 1.9014233	test: 8.9676521	best: 8.9676521 (91)	total: 31.2s	remaining: 5m 7s
92:	learn: 1.9011186	test: 8.9677901	best: 8.9676521 (91)	total: 32.1s	remaining: 5m 13s
93:	learn: 1.9008316	test: 8.9677856	best: 8.9676521 (91)	total: 32.6s	remaining: 5m 14s
94:	learn: 1.8998135	test: 8.9678121	best: 8.9676521 (91)	total: 33.3s	remaining: 5m 16s
95:	learn: 1.8988977	test: 8.9677911	best: 8.9676521 (91)	total: 33.6s	remaining: 5m 16s
96:	learn: 1.8986541	test: 8.9675947	best: 8.9675947 (96)	total: 33.9s	remaining: 5m 15s
97:	learn: 1.8980265	test: 8.9676082	best: 8.9675947 (96)	total: 34.3s	remaining: 5m 15s
98:	learn: 1.8978497	test: 8.9675173	best: 8.9675173 (98)	total: 34.6s	remaining: 5m 15s
99:	learn: 1.8942698	test: 8.9593814	best: 8.9593814 (99)	total: 35.4s	remaining: 5m 18s
100:	learn: 1.8935714	test: 8.9591959	best: 8.9591959 (100)	total: 35.8s	remaining: 5m 18s
101:	learn: 1.8932886	test: 8.9593890	best: 8.9591959 (100)	total: 36.5s	remaining: 5m 21s
102:	learn: 1.8914082	test: 8.9595186	best: 8.9591959 (100)	total: 36.9s	remaining: 5m 21s
103:	learn: 1.8911552	test: 8.9589037	best: 8.9589037 (103)	total: 37.4s	remaining: 5m 22s
104:	learn: 1.8910254	test: 8.9589108	best: 8.9589037 (103)	total: 37.8s	remaining: 5m 22s
105:	learn: 1.8904893	test: 8.9588550	best: 8.9588550 (105)	total: 38.2s	remaining: 5m 22s
106:	learn: 1.8894389	test: 8.9588495	best: 8.9588495 (106)	total: 38.7s	remaining: 5m 22s
107:	learn: 1.8892436	test: 8.9588291	best: 8.9588291 (107)	total: 39.3s	remaining: 5m 24s
108:	learn: 1.8889646	test: 8.9588127	best: 8.9588127 (108)	total: 39.6s	remaining: 5m 24s
109:	learn: 1.8878755	test: 8.9588197	best: 8.9588127 (108)	total: 40.1s	remaining: 5m 24s
110:	learn: 1.8872669	test: 8.9585111	best: 8.9585111 (110)	total: 40.4s	remaining: 5m 23s
111:	learn: 1.8868385	test: 8.9586696	best: 8.9585111 (110)	total: 40.7s	remaining: 5m 22s
112:	learn: 1.8864233	test: 8.9586579	best: 8.9585111 (110)	total: 41.4s	remaining: 5m 24s
113:	learn: 1.8861924	test: 8.9585940	best: 8.9585111 (110)	total: 42.4s	remaining: 5m 29s
114:	learn: 1.8854541	test: 8.9587081	best: 8.9585111 (110)	total: 42.7s	remaining: 5m 28s
115:	learn: 1.8850305	test: 8.9583637	best: 8.9583637 (115)	total: 43.2s	remaining: 5m 29s
116:	learn: 1.8849010	test: 8.9583476	best: 8.9583476 (116)	total: 43.7s	remaining: 5m 29s
117:	learn: 1.8845855	test: 8.9576255	best: 8.9576255 (117)	total: 44.1s	remaining: 5m 29s
118:	learn: 1.8843162	test: 8.9578108	best: 8.9576255 (117)	total: 44.7s	remaining: 5m 30s
119:	learn: 1.8841183	test: 8.9573224	best: 8.9573224 (119)	total: 45.1s	remaining: 5m 30s
120:	learn: 1.8838699	test: 8.9572941	best: 8.9572941 (120)	total: 45.7s	remaining: 5m 31s
121:	learn: 1.8837094	test: 8.9572764	best: 8.9572764 (121)	total: 46s	remaining: 5m 31s
122:	learn: 1.8833882	test: 8.9572214	best: 8.9572214 (122)	total: 46.4s	remaining: 5m 31s
123:	learn: 1.8832684	test: 8.9572236	best: 8.9572214 (122)	total: 47s	remaining: 5m 31s
124:	learn: 1.8824690	test: 8.9574352	best: 8.9572214 (122)	total: 47.4s	remaining: 5m 31s
125:	learn: 1.8814911	test: 8.9574159	best: 8.9572214 (122)	total: 47.8s	remaining: 5m 31s
126:	learn: 1.8812084	test: 8.9575886	best: 8.9572214 (122)	total: 48.1s	remaining: 5m 30s
127:	learn: 1.8811016	test: 8.9575755	best: 8.9572214 (122)	total: 48.6s	remaining: 5m 30s
128:	learn: 1.8808306	test: 8.9575058	best: 8.9572214 (122)	total: 48.9s	remaining: 5m 30s
129:	learn: 1.8805813	test: 8.9575100	best: 8.9572214 (122)	total: 49.2s	remaining: 5m 29s
130:	learn: 1.8805152	test: 8.9574953	best: 8.9572214 (122)	total: 49.6s	remaining: 5m 28s
131:	learn: 1.8803587	test: 8.9574726	best: 8.9572214 (122)	total: 49.8s	remaining: 5m 27s
132:	learn: 1.8802771	test: 8.9576284	best: 8.9572214 (122)	total: 50.1s	remaining: 5m 26s
133:	learn: 1.8801940	test: 8.9576556	best: 8.9572214 (122)	total: 50.4s	remaining: 5m 25s
134:	learn: 1.8800759	test: 8.9576467	best: 8.9572214 (122)	total: 50.7s	remaining: 5m 24s
135:	learn: 1.8799391	test: 8.9576976	best: 8.9572214 (122)	total: 51.1s	remaining: 5m 24s
136:	learn: 1.8793609	test: 8.9577197	best: 8.9572214 (122)	total: 51.4s	remaining: 5m 23s
137:	learn: 1.8790448	test: 8.9592154	best: 8.9572214 (122)	total: 51.6s	remaining: 5m 22s
138:	learn: 1.8785808	test: 8.9588304	best: 8.9572214 (122)	total: 51.9s	remaining: 5m 21s
139:	learn: 1.8783280	test: 8.9588188	best: 8.9572214 (122)	total: 52.3s	remaining: 5m 21s
140:	learn: 1.8782473	test: 8.9587675	best: 8.9572214 (122)	total: 52.6s	remaining: 5m 20s
141:	learn: 1.8778002	test: 8.9587710	best: 8.9572214 (122)	total: 52.9s	remaining: 5m 19s
142:	learn: 1.8774486	test: 8.9587648	best: 8.9572214 (122)	total: 53.2s	remaining: 5m 18s
143:	learn: 1.8760550	test: 8.9587268	best: 8.9572214 (122)	total: 53.5s	remaining: 5m 17s
144:	learn: 1.8758821	test: 8.9586184	best: 8.9572214 (122)	total: 53.8s	remaining: 5m 17s
145:	learn: 1.8737911	test: 8.9585668	best: 8.9572214 (122)	total: 54s	remaining: 5m 16s
146:	learn: 1.8736906	test: 8.9585199	best: 8.9572214 (122)	total: 54.3s	remaining: 5m 15s
147:	learn: 1.8732627	test: 8.9584720	best: 8.9572214 (122)	total: 54.6s	remaining: 5m 14s
148:	learn: 1.8730862	test: 8.9584777	best: 8.9572214 (122)	total: 54.9s	remaining: 5m 13s
149:	learn: 1.8729792	test: 8.9584955	best: 8.9572214 (122)	total: 55.2s	remaining: 5m 13s
150:	learn: 1.8728461	test: 8.9582664	best: 8.9572214 (122)	total: 55.5s	remaining: 5m 12s
151:	learn: 1.8726593	test: 8.9582387	best: 8.9572214 (122)	total: 55.8s	remaining: 5m 11s
152:	learn: 1.8721132	test: 8.9582538	best: 8.9572214 (122)	total: 56.2s	remaining: 5m 10s
153:	learn: 1.8718073	test: 8.9582630	best: 8.9572214 (122)	total: 56.5s	remaining: 5m 10s
154:	learn: 1.8716035	test: 8.9582532	best: 8.9572214 (122)	total: 56.8s	remaining: 5m 9s
155:	learn: 1.8652943	test: 8.9806486	best: 8.9572214 (122)	total: 57.1s	remaining: 5m 8s
156:	learn: 1.8650829	test: 8.9806597	best: 8.9572214 (122)	total: 57.4s	remaining: 5m 8s
157:	learn: 1.8643521	test: 8.9806976	best: 8.9572214 (122)	total: 57.7s	remaining: 5m 7s
158:	learn: 1.8640522	test: 8.9806690	best: 8.9572214 (122)	total: 58s	remaining: 5m 6s
159:	learn: 1.8637584	test: 8.9808988	best: 8.9572214 (122)	total: 58.4s	remaining: 5m 6s
160:	learn: 1.8636074	test: 8.9808992	best: 8.9572214 (122)	total: 58.7s	remaining: 5m 5s
161:	learn: 1.8635229	test: 8.9808907	best: 8.9572214 (122)	total: 59s	remaining: 5m 5s
162:	learn: 1.8632419	test: 8.9808783	best: 8.9572214 (122)	total: 59.3s	remaining: 5m 4s
163:	learn: 1.8630281	test: 8.9809863	best: 8.9572214 (122)	total: 59.6s	remaining: 5m 3s
164:	learn: 1.8628420	test: 8.9808831	best: 8.9572214 (122)	total: 59.9s	remaining: 5m 2s
165:	learn: 1.8624684	test: 8.9813405	best: 8.9572214 (122)	total: 1m	remaining: 5m 2s
166:	learn: 1.8623708	test: 8.9815465	best: 8.9572214 (122)	total: 1m	remaining: 5m 1s
167:	learn: 1.8621560	test: 8.9811552	best: 8.9572214 (122)	total: 1m	remaining: 5m 1s
168:	learn: 1.8620841	test: 8.9811579	best: 8.9572214 (122)	total: 1m 1s	remaining: 5m
169:	learn: 1.8611429	test: 8.9811388	best: 8.9572214 (122)	total: 1m 1s	remaining: 4m 59s
170:	learn: 1.8599691	test: 8.9810791	best: 8.9572214 (122)	total: 1m 1s	remaining: 4m 59s
171:	learn: 1.8508718	test: 8.9903760	best: 8.9572214 (122)	total: 1m 1s	remaining: 4m 58s
172:	learn: 1.8474245	test: 8.9905854	best: 8.9572214 (122)	total: 1m 2s	remaining: 4m 57s
Stopped by overfitting detector  (50 iterations wait)

bestTest = 8.957221421
bestIteration = 122

Shrink model to first 123 iterations.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>63.07235407829285</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">feature_importances</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">get_feature_importance</span><span class="p">(</span><span class="n">train_pool</span><span class="p">)</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>
<span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">feature_importances</span><span class="p">,</span> <span class="n">feature_names</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">score</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>item_price: 33.16861862581194
shop_id: 30.35006874341807
item_id: 24.272024440825234
date_block_num: 12.209288189944767
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Predict-on-TEST">Predict on TEST<a class="anchor-link" href="#Predict-on-TEST">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Y_pred_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">Y_pred_valid</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>done
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

